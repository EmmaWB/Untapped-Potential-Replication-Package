------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  H:\.shortcut-targets-by-id\1-HUB-LpZUD5DBPfVEOldrYqSrJfPCYXg\triplethreat\study1\SMR Study 2 Replication Package/do/log/02_clean_activity_data.log
  log type:  text
 opened on:  25 Jun 2024, 09:00:24

. 
. * Clearing environment
. clear all

. 
. 
. 
. ********************************************************************************
. * Load data                                                                    *
. ********************************************************************************
. 
. * Import CSV storing activity data
. import delimited code time activity candidate ///
>         using "$data/rawdata/activity_data.csv", clear
(4 vars, 12,256 obs)

.         
. * Removing any odd characters from code
. charlist code
"0123456789abcdefghijklmnoprstuvwyz¯»¿ÂÃ

. return list

macros:
              r(chars) : ""0123456789abcdefghijklmnoprstuvwyz¯»¿ÂÃ"
           r(sepchars) : "" 0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p r s t u v w y z ¯ » ¿ Â Ã "
              r(ascii) : "34 48 49 50 51 52 53 54 55 56 57 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 114 115 116 117 118 119 121 122 175 187 191 194 195 "

. display r(ascii)
34 48 49 50 51 52 53 54 55 56 57 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 114 115 116 117 118 119 121 122 175 187 191 194 195 

. foreach i of numlist 123/195 {
  2. replace code = subinstr(code, "`=char(`i')'", "", .)
  3. }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(1 real change made)

. replace code = subinstr(code, char(34), "", .) // removes quotation marks
(1 real change made)

.         
. * Removing any odd characters from code (code is equivalent to unique user ID)
. ssc install charlist
checking charlist consistency and verifying not already installed...
all files already exist and are up to date.

. charlist code
0123456789abcdefghijklmnoprstuvwyz

. return list

macros:
              r(chars) : "0123456789abcdefghijklmnoprstuvwyz"
           r(sepchars) : "0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p r s t u v w y z "
              r(ascii) : "48 49 50 51 52 53 54 55 56 57 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 114 115 116 117 118 119 121 122 "

. display r(ascii)
48 49 50 51 52 53 54 55 56 57 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 114 115 116 117 118 119 121 122 

. foreach i of numlist 123/195 {
  2.         replace code = subinstr(code, "`=char(`i')'", "", .)
  3. }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. replace code = subinstr(code, char(34), "", .) // removes quotation marks
(0 real changes made)

. 
. * Replacing resume candidate number with 2 or 3
. * Note: this is necessary to merge with Qualtrics data. Candidate A = 2, Candidate B = 3. 
. replace candidate = candidate + 1
(12,256 real changes made)

. 
.         
. ********************************************************************************
. * Generating section status variables                                          *
. ********************************************************************************
. 
. * Which section is open
. gen section=.
(12,256 missing values generated)

. cap label drop section_lbl

. label def section_lbl 1 "Start" 2 "Education Open" 3 "Work Open" 4 "Misc Open"

. label val section section_lbl

. 
. * Setting sections open according to "opened" buttons
. replace section=1 if activity=="entered website"
(1,654 real changes made)

. replace section=2 if activity=="opened education section"
(1,983 real changes made)

. replace section=3 if activity=="opened work section"
(2,102 real changes made)

. replace section=4 if activity=="opened misc section"
(1,340 real changes made)

. 
. * If respondent "closes" a section, returns to "start"
. replace section=1 if activity=="closed education section" | ///
>         activity=="closed work section" | activity=="closed misc section"
(451 real changes made)

.         
. * Generating temporary variable to flag section activities
. gen section_tag=section!=.

. 
. * Creating variable: time of first/last activity
. gen double timestamp = clock(time, "MDY hms")

. bysort code candidate: egen double mintime = min(timestamp)

. bysort code candidate: egen double maxtime = max(timestamp)

. format timestamp mintime maxtime %tc

. 
. * Section open start times
. gen double section_start=clock(time, "MDY hms") if section!=.
(4,726 missing values generated)

. format section_start %tc

. 
. * Section close end times
. sort code candidate section_tag timestamp

. gen double section_end = section_start[_n+1] if code==code[_n+1] & ///
>         candidate==candidate[_n+1] & section_tag==1
(6,381 missing values generated)

. format section_end %tc

. replace section_end=maxtime if section_end==. & section_tag==1
(1,655 real changes made)

. 
. * Section total time
. gen sectiontime = seconds(section_end - section_start)
(4,726 missing values generated)

. 
.         
. ********************************************************************************
. * Applying labels                                                              *
. ********************************************************************************
. 
. label var code                          "Website Code"

. label var activity                      "Activity Description"

. label var candidate             "Candidate Number"

. label var section                       "Section Open"

. 
. * Creating subset of full dataset, with just section start times ---------------
. 
. * Subsetting data
. preserve

. keep if section_tag==1
(4,726 observations deleted)

. keep code candidate section section_start

. sort code candidate section_start section

. 
. * Tagging the first section button
. bysort code candidate (section_start section): gen sn = _n

. gen flag = sn==2 & section==1 // the second section logically cannot be "start"

. tab flag

       flag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      7,512       99.76       99.76
          1 |         18        0.24      100.00
------------+-----------------------------------
      Total |      7,530      100.00

. drop if sn==1 & section==1 // drop all "start" activities; assume start before first section is open.
(1,638 observations deleted)

. drop if sn==2 & section==1 // drop if second section is "start", logical fallacy
(18 observations deleted)

. drop sn flag

. 
. * Reshaping wide
. bysort code candidate: gen section_n = _n

. sum section_n // check the max

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   section_n |      5,874     3.42935    2.699464          1         26

. reshape wide section section_start, i(code candidate) j(section_n)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                     5874   ->    1340
Number of variables                   5   ->      54
j variable (26 values)        section_n   ->   (dropped)
xij variables:
                                section   ->   section1 section2 ... section26
                          section_start   ->   section_start1 section_start2 ... section_start26
-----------------------------------------------------------------------------

. 
. tab section1 // no "start" section1

     1 section |      Freq.     Percent        Cum.
---------------+-----------------------------------
Education Open |      1,271       94.85       94.85
     Work Open |         52        3.88       98.73
     Misc Open |         17        1.27      100.00
---------------+-----------------------------------
         Total |      1,340      100.00

. 
. * Saving file
. save "$data/section_status_wide.dta", replace
file H:\.shortcut-targets-by-id\1-HUB-LpZUD5DBPfVEOldrYqSrJfPCYXg\triplethreat\study1\SMR Study 2 Replication Package/data/section_status_wide.dta saved

. 
.         
. log close
      name:  <unnamed>
       log:  H:\.shortcut-targets-by-id\1-HUB-LpZUD5DBPfVEOldrYqSrJfPCYXg\triplethreat\study1\SMR Study 2 Replication Package/do/log/02_clean_activity_data.log
  log type:  text
 closed on:  25 Jun 2024, 09:00:26
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
